kind: pipeline
name: default

steps:
- name: lint
  image: node
  commands:
    - 'npm install'
    - 'npm run lint'
- name: test
  image: node
  commands:
    - 'npm install'
    - 'npm test'
- name: cf-deploy
  image: governmentpaas/cf-cli
  environment:
    GPAAS_APP_NAME: govuk-prototype-kit
    GPAAS_USER:
      from_secret: gpaas_user
    GPAAS_PASS:
      from_secret: gpaas_pass
    GPAAS_ORG: gds-tech-ops
    GPAAS_SPACE: sandbox
    GPAAS_API: api.cloud.service.gov.uk
  commands:
    # set api endpoint and login
    - 'cf login -a $GPAAS_API -u $GPAAS_USER -p "$GPAAS_PASS"'
    # set the target
    - 'cf target -o $GPAAS_ORG -s $GPAAS_SPACE'
    # push the apps
    - 'rm Procfile'
    - 'echo {\"collectUsageData\":false} > usage-data-config.json'
    - 'cf push $GPAAS_APP_NAME'

---
kind: secret
data:
  gpaas_user: i--4jbVi-skBP6JyLd1mklQXq4IL62lIHKIFz8QDezMV0xymPavtphOqHgSB4-HU0XyAz7s6W9SgPhQSoWZef3vj3962ZvnNdnLXIDvuOAR-
  gpaas_pass: xL4cd9NsPaaINa4oof_Yp7KGowkyflFwEg_Q_dhX7nnzXODb-LC3kCPGb3ZbAdyr0lkh16Mu3JuV2bxMHA2N
